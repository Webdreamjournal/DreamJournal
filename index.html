<!-- 
Dream Journal v2.00.0 - A privacy-focused dream tracking application
Copyright (C) 2025 Dream Journal Contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Journal</title>
    <link rel="stylesheet" href="dream-journal.css">
        <script>
        (function() {
            try {
            var theme = localStorage.getItem('dreamJournalTheme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {}
        })();
        </script>
</head>
<body>
    <!-- MAIN APPLICATION STRUCTURE -->
    
    <div class="container" style="visibility: hidden;">
        <div class="timer-warning" id="timerWarning">
            ‚ö†Ô∏è <strong>PIN RESET TIMER ACTIVE</strong> - Someone has initiated a PIN reset!
            <span id="timerWarningTime"></span>
            <button data-action="cancel-timer">Cancel Timer</button>
        </div>
        
        <div id="migrationNotice" class="migration-notice">
            üì¶ Migrating your dreams to improved storage...
        </div>
        
        <div class="header">
            <h1>üåô Dream Journal</h1>
            <p>Capture your dreams and discover patterns for lucid dreaming</p>
        </div>
        
        <!-- Main App Tabs Navigation -->
        <div class="app-tabs">
            <button class="app-tab active" data-action="switch-app-tab" data-tab="journal">
                üìù Journal
            </button>
            <button class="app-tab" data-action="switch-app-tab" data-tab="goals">
                üéØ Goals
            </button>
            <button class="app-tab" data-action="switch-app-tab" data-tab="stats">
                üìä Stats
            </button>
            <button class="app-tab" data-action="switch-app-tab" data-tab="advice">
                üí° Advice
            </button>
            <button class="app-tab" data-action="switch-app-tab" data-tab="settings">
                ‚öôÔ∏è Settings
            </button>
            <button class="app-tab" data-action="switch-app-tab" data-tab="lock" style="display: none;">
                üîí Locked
            </button>
        </div>
        
        <!-- Tab Content Container -->
        <div class="tab-content-container">
            <!-- Journal Tab (All existing functionality) -->
            <div id="journalTab" class="tab-panel">
        <div class="main-content">
            <div class="entry-form" id="dreamFormFull">
                <h3 data-action="toggle-dream-form" style="cursor: pointer; user-select: none;">
                    üåô Record Your Dream 
                    <span class="text-xs text-secondary font-normal">(Click to collapse)</span>
                </h3>
                <div class="form-group">
                    <label for="dreamDate">Dream Date & Time</label>
                    <input type="datetime-local" id="dreamDate" class="form-control">
                </div>
                <div class="lucid-checkbox">
                    <input type="checkbox" id="isLucid">
                    <label for="isLucid">This was a lucid dream ‚ú®</label>
                </div>
                <div class="form-group">
                    <label for="dreamTitle">Dream Title (optional)</label>
                    <input type="text" id="dreamTitle" class="form-control" placeholder="Give your dream a memorable title...">
                </div>
                <div class="form-group">
                    <label for="dreamContent">Dream Description</label>
                    <textarea id="dreamContent" class="form-control" placeholder="Describe your dream in as much detail as you can remember..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="dreamEmotions">Emotions Experienced (optional)</label>
                    <input type="text" id="dreamEmotions" class="form-control" placeholder="e.g., happy, anxious, excited, confused (separate with commas)">
                    <small class="small-helper">
                        Common emotions: happy, sad, anxious, excited, confused, peaceful, scared, angry, joyful, curious
                    </small>
                </div>
                <div class="form-group">
                    <label for="dreamTags">Tags & Themes (optional)</label>
                    <div class="tag-input-group">
                        <input type="text" id="dreamTags" class="form-control" placeholder="e.g., family, flying, school, animals (separate with commas)">
                    </div>
                    <small class="small-helper">
                        Tag your dream with themes, people, places, objects, or activities for easy searching
                    </small>
                </div>
                <div class="form-group">
                    <label for="dreamSigns">‚ö° Dream Signs (Lucidity Triggers) (optional)</label>
                    <div class="tag-input-group">
                        <input type="text" id="dreamSigns" class="form-control" placeholder="e.g., flying, text-changing, deceased-alive (separate with commas)">
                    </div>
                    <small class="small-helper-warning">
                        Elements that could trigger lucidity - track these to improve dream awareness!
                    </small>
                </div>
                <button data-action="save-dream" class="btn btn-primary">Save Dream</button>
            </div>
            
            <!-- Collapsed Form State -->
            <div class="entry-form" id="dreamFormCollapsed" style="display: none;">
                <h3 data-action="toggle-dream-form" style="cursor: pointer; user-select: none;">
                    üìù Record Your Dream 
                    <span class="text-xs text-secondary font-normal">(Click to expand)</span>
                </h3>
            </div>
            
            <div class="voice-tabs-container">
                <div class="voice-tabs">
                    <button class="voice-tab active" data-action="switch-voice-tab" data-tab="record">
                        üé§ Record
                    </button>
                    <button class="voice-tab" data-action="switch-voice-tab" data-tab="stored">
                        üéµ Stored Notes
                    </button>
                </div>
                
                <div class="voice-tab-content">
                    <!-- Record Tab -->
                    <div id="voiceTabRecord" class="voice-tab-panel active">
                        <div class="voice-controls">
                            <button id="recordBtn" data-action="toggle-recording" class="record-btn ready">
                                <span id="recordIcon">üé§</span>
                                <span id="recordText">Start Recording</span>
                            </button>
                            <div id="recordingTimer" class="recording-timer" style="display: none;">0:00</div>
                            <div id="voiceStatus" class="voice-status info">Checking browser capabilities for voice features...</div>
                        </div>
                    </div>
                    
                    <!-- Stored Notes Tab -->
                    <div id="voiceTabStored" class="voice-tab-panel" style="display: none;">
                        <div id="voiceNotesContainer"></div>
                    </div>
                </div>
            </div>
            <div class="dreams-section-header">
                <h3>Your Dreams</h3>
                <div class="dreams-controls">
                    <button data-action="toggle-lock" id="lockBtn" class="btn btn-lock" title="Set up a PIN to secure your dreams, then lock the journal">üîí Setup & Lock</button>
                    <button data-action="export-ai" class="btn btn-success" title="Export a prompt for analysis by an AI model">ü§ñ Export for AI Analysis</button>
                </div>
            </div>
            <div class="controls">
            <div class="search-filter-group">
                <input type="text" id="searchBox" class="search-box" placeholder="Search dreams by title, content, emotions, tags, or dream signs...">
                <select id="filterSelect" class="filter-select">
                    <option value="all">All Dreams</option>
                    <option value="lucid">Lucid Dreams</option>
                    <option value="non-lucid">Non-Lucid Dreams</option>
                </select>
                <select id="sortSelect" class="filter-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="lucid-first">Lucid First</option>
                    <option value="longest">Longest First</option>
                </select>
                <select id="limitSelect" class="filter-select">
                    <option value="5">Show 5</option>
                    <option value="10">Show 10</option>
                    <option value="20">Show 20</option>
                    <option value="50">Show 50</option>
                    <option value="endless" selected>Endless</option>
                    <option value="all">Show All</option>
                </select>
            </div>
            <div class="date-filter-group" style="display: grid; grid-template-columns: auto 1fr auto 1fr; gap: 8px; align-items: center;">
                <label for="startDateFilter" class="form-label-inline text-primary" style="font-size: 13px;">From:</label>
                <input type="date" id="startDateFilter" class="filter-select" style="padding: 8px; font-size: 14px;">
                <label for="endDateFilter" class="form-label-inline text-primary" style="font-size: 13px;">To:</label>
                <input type="date" id="endDateFilter" class="filter-select" style="padding: 8px; font-size: 14px;">
            </div>
            <div class="control-row-break"></div>
        </div>
            <div class="entries-section">
                <div id="entriesContainer"></div>
                <div id="paginationContainer"></div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="app-footer">
        <div style="max-width: 800px; margin: 0 auto;">
            <p style="margin-bottom: 10px;">
                <strong>Disclaimer:</strong> This application is for entertainment and personal journaling purposes only. 
                It is not intended to provide medical, psychological, or therapeutic advice. 
                If you have concerns about your sleep, dreams, or mental health, please consult a qualified healthcare professional.
            </p>
            <p style="margin-bottom: 10px; font-size: 12px;">
                Licensed under <a href="https://www.gnu.org/licenses/agpl-3.0.html" target="_blank" style="color: var(--primary-color);">AGPL v3.0</a> | <a href="https://github.com/Webdreamjournal/DreamJournal" target="_blank" style="color: var(--primary-color);">Source Code</a>
            </p>
            <p class="app-footer p">
                Dream Journal v2.00.10 | Not a substitute for professional medical advice
            </p>
        </div>
    </footer>

    <!-- PIN Protection Overlay -->
    <div id="pinOverlay" class="pin-overlay" style="display: none;">
        <div class="pin-container">
            <h2 id="pinTitle">üîí Enter PIN</h2>
            <p id="pinMessage">Your dreams are protected. Enter your PIN to access them.</p>
            <input type="password" id="pinInput" class="pin-input" placeholder="Enter PIN" maxlength="6">
            <div class="pin-buttons">
                <button data-action="verify-pin" class="btn btn-primary" id="pinMainBtn">Unlock</button>
                <button data-action="hide-pin-overlay" class="btn btn-secondary" id="cancelPinBtn">Cancel</button>
            </div>
            <div id="pinFeedback" class="notification-message error"></div>
            <div id="pinSuccess" class="notification-message success"></div>
            <div id="pinInfo" class="notification-message info"></div>
            <span data-action="show-pin-setup" class="pin-setup-link" id="pinSetupLink">Setup new PIN</span>
            <span data-action="show-remove-pin" class="pin-setup-link" id="removePinLink" style="display: none;">Remove PIN protection</span>
            <span data-action="show-forgot-pin" class="pin-setup-link" id="forgotPinLink" style="display: none;">Forgot PIN?</span>
        </div>
    </div>

    <input type="file" id="importFile" class="file-input" accept=".txt,.enc">
    <input type="file" id="importAllDataFile" class="file-input" accept=".json,.enc">
    <script src="constants.js"></script>
    <script src="state.js"></script>
    <script src="storage.js"></script>
    <script src="dom-helpers.js"></script>
    <script src="security.js"></script>
    <script src="dream-crud.js"></script>
    <script src="voice-notes.js"></script>
    <script src="goals.js"></script>
    <script src="stats.js"></script>
    <script src="import-export.js"></script>
    <script src="action-router.js"></script>
    <script src="main.js"></script>
    <script src="app.js"></script>
</body>
</html>
