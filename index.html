<!-- 
Dream Journal - A privacy-focused dream tracking application
Copyright (C) 2025 Dream Journal Contributors

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic document metadata and viewport configuration -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Journal</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dream Journal">
    <meta name="application-name" content="Dream Journal">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    
    <!-- Favicon -->
    <link rel="icon" href="icons/favicon.ico" sizes="any">
    
    <!-- Main stylesheet for application styling and themes -->
    <link rel="stylesheet" href="app.css">
    
    <!-- Inline theme initialization script to prevent flash of unstyled content -->
    <script>
        (function() {
            try {
                // Load saved theme preference or default to dark theme
                var theme = localStorage.getItem('dreamJournalTheme') || 'dark';
                // Apply theme immediately to document root for CSS custom properties
                document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {
                // Silently handle localStorage access errors (e.g., private browsing)
            }
        })();
    </script>
</head>
<body>
    <!-- ARIA: Global announcer for SPA navigation -->
    <div id="route-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    <!-- ARIA: Comprehensive live regions for dynamic content announcements -->
    <div id="form-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
    <div id="search-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
    <div id="status-announcer" class="visually-hidden" aria-live="assertive" aria-atomic="true"></div>
    <div id="progress-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
    <div id="validation-announcer" class="visually-hidden" aria-live="assertive" aria-atomic="true"></div>
    
    <!-- ================================ -->
    <!-- MAIN APPLICATION STRUCTURE       -->
    <!-- ================================ -->
    
    <!-- Main application container - Initially hidden until initialization completes -->
    <div class="container" style="visibility: hidden;">
        
        <!-- PIN Reset Timer Warning Banner - Shows when PIN reset timer is active -->
        <div class="timer-warning" id="timerWarning">
            ‚ö†Ô∏è <strong>PIN RESET TIMER ACTIVE</strong> - Someone has initiated a PIN reset!
            <span id="timerWarningTime"></span>
            <button data-action="cancel-timer">Cancel Timer</button>
        </div>
        
        <!-- Data Migration Notice - Shows during IndexedDB migration process -->
        <div id="migrationNotice" class="migration-notice">
            üì¶ Migrating your dreams to improved storage...
        </div>
        
        <!-- Application Header - Logo and tagline -->
        <div class="header">
            <h1><img src="icons/logo.png" alt="üåô " style="height: 1.2em; vertical-align: text-bottom;">Dream Journal</h1>
            <p>Capture your dreams and discover patterns for lucid dreaming</p>
        </div>
        
        <!-- ================================ -->
        <!-- MAIN APPLICATION TABS NAVIGATION -->
        <!-- ================================ -->
        <div class="app-tabs" role="tablist" aria-label="Dream Journal Navigation">
            <!-- Journal Tab - Main dream entry and viewing interface (default active) -->
            <button class="app-tab active" 
                    data-action="switch-app-tab" 
                    data-tab="journal"
                    role="tab"
                    aria-selected="true"
                    aria-controls="journalTab"
                    id="tab-journal">
                üìù Journal
            </button>
            
            <!-- Goals Tab - Lucid dreaming goals and progress tracking -->
            <button class="app-tab" 
                    data-action="switch-app-tab" 
                    data-tab="goals"
                    role="tab"
                    aria-selected="false"
                    aria-controls="goalsTab"
                    id="tab-goals"
                    tabindex="-1">
                üéØ Goals
            </button>
            
            <!-- Statistics Tab - Analytics, calendar view, and dream insights -->
            <button class="app-tab" 
                    data-action="switch-app-tab" 
                    data-tab="stats"
                    role="tab"
                    aria-selected="false"
                    aria-controls="statsTab"
                    id="tab-stats"
                    tabindex="-1">
                üìä Stats
            </button>
            
            <!-- Advice Tab - Daily tips and lucid dreaming guidance -->
            <button class="app-tab" 
                    data-action="switch-app-tab" 
                    data-tab="advice"
                    role="tab"
                    aria-selected="false"
                    aria-controls="adviceTab"
                    id="tab-advice"
                    tabindex="-1">
                üí° Advice
            </button>
            
            <!-- Settings Tab - App configuration, theme, PIN setup, import/export -->
            <button class="app-tab" 
                    data-action="switch-app-tab" 
                    data-tab="settings"
                    role="tab"
                    aria-selected="false"
                    aria-controls="settingsTab"
                    id="tab-settings"
                    tabindex="-1">
                ‚öôÔ∏è Settings
            </button>
            
            <!-- Lock Tab - Security lock screen (hidden by default, shown when app is locked) -->
            <button class="app-tab" data-action="switch-app-tab" data-tab="lock" style="display: none;">
                üîí Locked
            </button>
        </div>
        
        <!-- ================================ -->
        <!-- TAB CONTENT CONTAINER            -->
        <!-- ================================ -->
        <div class="tab-content-container">
            
            <!-- ================================ -->
            <!-- JOURNAL TAB - DREAM ENTRY FORM  -->
            <!-- ================================ -->
            <div id="journalTab" class="tab-panel">
                <!-- Content dynamically generated by journaltab.js -->
                <div class="loading-state">
                    <div>Loading your journal...</div>
                </div>
            </div>
        </div>
        <!-- ================================ -->
        <!-- APPLICATION FOOTER               -->
        <!-- ================================ -->
        <footer class="app-footer">
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Legal Disclaimer - Medical/psychological advice warning -->
                <p style="margin-bottom: 10px;">
                    <strong>Disclaimer:</strong> This application is for entertainment and personal journaling purposes only. 
                    It is not intended to provide medical, psychological, or therapeutic advice. 
                    If you have concerns about your sleep, dreams, or mental health, please consult a qualified healthcare professional.
                </p>
                
                <!-- License Information and Source Code Links -->
                <p style="margin-bottom: 10px; font-size: 12px;">
                    Licensed under <a href="https://www.gnu.org/licenses/agpl-3.0.html" target="_blank" style="color: var(--primary-color);">AGPL v3.0</a> | <a href="https://github.com/Webdreamjournal/DreamJournal" target="_blank" style="color: var(--primary-color);">Source Code</a>
                </p>
                
                <!-- Version Information and Additional Medical Disclaimer -->
                <p>
                    Dream Journal v2.04.63 | Not a substitute for professional medical advice
                </p>
            </div>
        </footer>
    </div>
    


    
    <!-- ================================ -->
    <!-- PIN PROTECTION OVERLAY SYSTEM    -->
    <!-- ================================ -->
    <div id="pinOverlay" 
         class="pin-overlay" 
         style="display: none;"
         role="dialog"
         aria-modal="true"
         aria-labelledby="pinTitle"
         aria-describedby="pinMessage">
        <div class="pin-container">
            <!-- PIN Dialog Title - Dynamic based on operation type -->
            <h2 id="pinTitle">üîí Enter PIN</h2>
            
            <!-- PIN Dialog Message - Context-specific instructions -->
            <p id="pinMessage">Your dreams are protected. Enter your PIN to access them.</p>
            
            <!-- PIN Input Field - Password input with 6-character limit -->
            <input type="password" id="pinInput" class="pin-input" placeholder="Enter PIN" maxlength="6">
            
            <!-- PIN Action Buttons -->
            <div class="pin-buttons">
                <!-- Primary Action Button - Changes based on context (Unlock/Setup/etc.) -->
                <button data-action="verify-pin" class="btn btn-primary" id="pinMainBtn">Unlock</button>
                
                <!-- Cancel Button - Closes PIN overlay -->
                <button data-action="hide-pin-overlay" class="btn btn-secondary" id="cancelPinBtn">Cancel</button>
            </div>
            
            <!-- PIN Feedback Message Containers -->
            <div id="pinFeedback" class="notification-message error"></div>
            <div id="pinSuccess" class="notification-message success"></div>
            <div id="pinInfo" class="notification-message info"></div>
            
            <!-- PIN Management Links -->
            <span data-action="show-pin-setup" class="pin-setup-link" id="pinSetupLink">Setup new PIN</span>
            <span data-action="show-remove-pin" class="pin-setup-link" id="removePinLink" style="display: none;">Remove PIN protection</span>
            <span data-action="show-forgot-pin" class="pin-setup-link" id="forgotPinLink" style="display: none;">Forgot PIN?</span>
        </div>
    </div>

    <!-- ================================ -->
    <!-- HIDDEN FILE INPUT ELEMENTS       -->
    <!-- ================================ -->
    <!-- Dreams Import File Input - Triggered programmatically by import buttons -->
    <input type="file" id="importFile" class="file-input" accept=".txt,.enc">
    
    <!-- Complete Data Import File Input - Triggered programmatically by import buttons -->
    <input type="file" id="importAllDataFile" class="file-input" accept=".json,.enc">
    
    <!-- ================================ -->
    <!-- JAVASCRIPT MODULE LOADING        -->
    <!-- ================================ -->

    <!-- Dropbox JavaScript SDK for Cloud Sync -->
    <script src="https://cdn.jsdelivr.net/npm/dropbox@10.34.0/dist/Dropbox-sdk.min.js"></script>

    <!-- Form Validation Module -->
    <script src="form-validation.js"></script>

    <!-- ES Module Entry Point - Phase 1.2 Implementation -->
    <!-- ES Module Entry Point - All dependencies loaded through import chain -->
    <script type="module" src="./src/app.js"></script>
    
    <!-- Legacy Script Fallback for browsers that don't support ES modules -->
    <script nomodule>
        // For IE and very old browsers - would need a bundled version
        document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>Browser Not Supported</h2><p>This application requires a modern browser that supports ES modules. Please update your browser or try Chrome, Firefox, Safari, or Edge.</p></div>';
    </script>
</body>
</html>
